(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1419:function(e,t,s){"use strict";s.r(t);var a=s(0),i=s.n(a),n=s(1),r=s.n(n),o=s(218),h=s(1209),l=s(196),c=s(371),p=s(372),d=s(606),u=s(9),g=s(40),m=s(120),w=s.n(m);const y=s(208),k={paper:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%",marginTop:1},submit:{margin:"3 0 2 0"}};class b extends i.a.Component{constructor(e){super(e),this.state={refreshing:!1,dialogOpen:!1,email:"",password:"",rePassword:"",address:"",phone:"",name:""},this.submit=this.submit.bind(this),this.showForm=this.showForm.bind(this),this.createUserGoogle=this.createUserGoogle.bind(this),this.createUserFacebook=this.createUserFacebook.bind(this)}async componentDidMount(){const{getLabel:e}=this.context.apis;this.constraints={email:{presence:{allowEmpty:!1,message:"^"+e("Bạn chưa nhập địa chỉ email")},email:{message:"^"+e("Địa chỉ email này không hợp lệ")}},name:{presence:{allowEmpty:!1,message:"^"+e("Bạn chưa nhập họ và tên đầy đủ")}},address:{presence:{allowEmpty:!0,message:"^"+e("Bạn chưa nhập địa chỉ")}},phone:{presence:{allowEmpty:!0,message:"^"+e("Bạn chưa nhập số điện thoại để liên hệ")}},password:{presence:{allowEmpty:!1,message:"^"+e("Bạn chưa nhập mật khẩu")},length:{minimum:6,message:"^"+e("Mật khẩu phải ít nhất 6 ký tự")}},rePassword:{presence:{allowEmpty:!1,message:"^"+e("Bạn chưa nhập xác nhận mật khẩu")},equality:{attribute:"password",message:"^"+e("Hai mật khẩu không khớp nhau")}}}}showForm(e,t,s){let a={dialogOpen:!0,error:"",email:"",password:"",rePassword:"",address:"",phone:"",name:"",rs:"",running:!1,google_id_token:"",facebook_token:""};e&&(a=Object.assign(a,e)),this.setState(a),this.onSuccess=t,this.onCancel=s}handleClose(){this.setState({dialogOpen:!1})}handleCancel(){this.setState({dialogOpen:!1},()=>{this.onCancel&&this.onCancel()})}async createUserGoogle(e){e.picture=this.state.picture;let t=`${this.context.config.server_url}/createUser/google?id_app=${this.context.config.id_app}&group_id=${this.context.config.group_id}&id_token=${this.state.google_id_token}&email=${e.email}&password=${e.password}`;try{let s=JSON.parse(await this.context.apis.asyncGet(t));if(s.error)return void this.setState({error:s.error,running:!1});let a=s.access_token;t=this.context.config.server_url+"/api/updateprofile?access_token="+a,await this.context.apis.asyncPost(t,null,e,"POST","updateProfile"),s=await this.context.apis.asyncGetUserInfoByToken(a),s.token=a,localStorage.setItem("token",a),this.setState({error:"",running:!1,dialogOpen:!1}),this.onSuccess&&this.onSuccess(s)}catch(e){this.setState({error:e.message,running:!1})}}async createUserFacebook(e){e.picture=this.state.picture;let t=`${this.context.config.server_url}/createUser/facebook?id_app=${this.context.config.id_app}&group_id=${this.context.config.group_id}&access_token=${this.state.facebook_token}&email=${e.email}&password=${e.password}`;try{let s=JSON.parse(await this.context.apis.asyncGet(t));if(s.error)return void this.setState({error:s.error,running:!1});let a=this.state.facebook_token;t=this.context.config.server_url+"/api/updateprofile?access_token="+a,await this.context.apis.asyncPost(t,null,e,"updateProfile"),s=await this.context.apis.asyncGetUserInfoByToken(a),s.token=a,localStorage.setItem("token",a),this.setState({error:"",running:!1,dialogOpen:!1}),this.onSuccess&&this.onSuccess(s)}catch(e){this.setState({error:e.message,running:!1})}}onKeyPress(e){"Enter"===e.key&&(this.submit(),e.preventDefault())}async submit(){let e={email:this.state.email,name:this.state.name,password:this.state.password,rePassword:this.state.rePassword,address:this.state.address,phone:this.state.phone},t=y(e,this.constraints,{format:"flat"});if(t){let e=t.join("<br/>");this.setState({error:e,running:!1})}else{if(this.setState({running:!0,error:""}),this.context.setProgressStatus(!0),this.state.google_id_token)return this.context.setProgressStatus(!1),await this.createUserGoogle(e);if(this.state.facebook_token)return this.context.setProgressStatus(!1),await this.createUserFacebook(e);try{await this.context.apis.asyncSignup(e)}catch(e){return this.setState({error:e.message,running:!1}),void this.context.setProgressStatus(!1)}try{let t=await this.context.apis.asyncLoginAPI(e.email,e.password);this.setState({error:"",running:!1,dialogOpen:!1}),this.onSuccess&&this.onSuccess(t)}catch(e){this.setState({error:e.message,running:!1})}this.context.setProgressStatus(!1)}}dialog(){return i.a.createElement(c.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"sm",open:this.state.dialogOpen},i.a.createElement(d.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},i.a.createElement(l.a,{container:!0,direction:"row",justify:"space-between"},i.a.createElement(l.a,{item:!0},this.context.apis.getLabel("Đăng ký tài khoản")),i.a.createElement(l.a,{item:!0},i.a.createElement(o.a,{onClick:()=>this.handleCancel(),style:{color:this.context.config.mainTextColor}},i.a.createElement(w.a,{style:{color:"silver"}}))))),i.a.createElement(p.a,null,i.a.createElement("div",{style:k.paper},i.a.createElement("form",{style:k.form,noValidate:!0},i.a.createElement(h.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:this.context.apis.getLabel("Email đăng nhập"),disabled:this.state.google_id_token||this.state.facebook_token,autoFocus:!0,value:this.state.email,autoComplete:"new-password",onKeyPress:this.onKeyPress.bind(this),onChange:e=>this.setState({email:e.target.value})}),i.a.createElement(h.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"name",label:this.context.apis.getLabel("Họ và tên đầy đủ"),value:this.state.name,autoComplete:"new-password",onKeyPress:this.onKeyPress.bind(this),onChange:e=>this.setState({name:e.target.value})}),i.a.createElement(h.a,{error:this.state.password&&this.state.password.length<6,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:this.context.apis.getLabel("Mật khẩu"),autoComplete:"new-password",helperText:this.state.password&&this.state.password.length<6?this.context.apis.getLabel("Mật khẩu phải từ 6 ký tự trở lên"):null,type:"password",id:"password",value:this.state.password,onKeyPress:this.onKeyPress.bind(this),onChange:e=>this.setState({password:e.target.value})}),i.a.createElement(h.a,{error:this.state.password&&this.state.rePassword&&this.state.password!==this.state.rePassword,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:this.context.apis.getLabel("Xác nhận mật khẩu"),type:"password",id:"repassword",autoComplete:"new-password",value:this.state.rePassword,helperText:this.state.password&&this.state.rePassword&&this.state.password!==this.state.rePassword?this.context.apis.getLabel("Hai mật khẩu phải giống nhau"):null,onKeyPress:this.onKeyPress.bind(this),onChange:e=>this.setState({rePassword:e.target.value})}),i.a.createElement("div",{style:{color:"red",textAlign:"center",padding:10},dangerouslySetInnerHTML:{__html:this.state.error}}),i.a.createElement(o.a,{type:"Button",fullWidth:!0,variant:"contained",color:"secondary",style:k.submit,disabled:this.state.running,onClick:this.submit},this.context.apis.getLabel("Đăng ký"))))))}render(){return this.dialog()}}b.contextType=u.a,b.propTypes={mediaQueryMatches:r.a.bool},t.default=Object(g.a)("(max-width:480px)")(b)}}]);