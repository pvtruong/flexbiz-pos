(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1434:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(1),i=a.n(r),o=a(218),l=a(1209),c=a(1187),h=a(1201),d=a(1186),u=a(196),m=a(371),p=a(372),g=a(606),x=a(120),f=a.n(x),y=a(9),w=a(40),E=a(1206),b=a(280),v=a(1190),C=a(1192),S=a(22),k=a.n(S),T=a(53),P=a(7),O=a(130);const I={paper:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%",marginTop:1},submit:{margin:"3 0 2 0"}};class _ extends n.a.PureComponent{constructor(e){super(e),this.state={refreshing:!1,dialogOpen:!1,from:"",to:"",memo:"",amount:""},this.submit=this.submit.bind(this),this.showForm=this.showForm.bind(this)}async componentDidMount(){}showForm(e,t,a,s){this.context.signin(n=>{let r={dialogOpen:!0,error:"",to:"",amount:"",denom:t,wallet:e};a&&(r=Object.assign(r,a)),r.from=r.address,this.setState(r),this.onSuccess=s})}handleClose(){this.setState({dialogOpen:!1})}async submit(){let e={from:this.state.wallet.address,to:this.state.to,amount:this.state.amount,denom:this.state.denom,memo:this.state.memo};this.context.setProgressStatus(!0);try{let t=`${this.context.config.server_url}/api/${this.state.wallet.id_app}/asskey/spend?access_token=${this.context.userInfo.token}`,a=JSON.parse(await this.context.apis.asyncPost(t,null,e,"POST","spend"));if(a.code)return this.context.alert(a.rawLog);this.setState({dialogOpen:!1}),this.onSuccess&&this.onSuccess(a),this.context.setProgressStatus(!1)}catch(e){this.context.alert(e.message)}}dialog(){return n.a.createElement(m.a,{fullScreen:!1,fullWidth:!0,maxWidth:"sm",open:this.state.dialogOpen},n.a.createElement(g.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},n.a.createElement(u.a,{container:!0,direction:"row",justify:"space-between"},n.a.createElement(u.a,{item:!0},this.context.apis.getLabel("Chuyển token")),n.a.createElement(u.a,{item:!0},n.a.createElement(o.a,{onClick:()=>this.handleClose()},"Close")))),n.a.createElement(p.a,null,n.a.createElement("div",{style:I.paper},n.a.createElement("form",{style:I.form,noValidate:!0},n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:this.context.apis.getLabel("Gửi tới"),value:this.state.to,onChange:e=>this.setState({to:e.target.value})}),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,type:"text",label:this.context.apis.getLabel("Số lượng")+`(${this.state.denom})`,value:this.state.amount,onChange:e=>this.setState({amount:e.target.value})}),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:this.context.apis.getLabel("Nội dung"),value:this.state.memo,onChange:e=>this.setState({memo:e.target.value})}),n.a.createElement(o.a,{type:"Button",fullWidth:!0,variant:"contained",color:"secondary",disabled:!this.state.to||!this.state.amount||!this.state.memo,onClick:this.submit},this.context.apis.getLabel("Gửi"))))))}render(){return this.dialog()}}_.contextType=y.a;var W=_,$=a(1134),L=a(1136),D=a(1189),B=a(14),q=a.n(B);function F({tx:e}){return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(b.a,{variant:"subtitle1"},e.tx.value.msg[0].type),n.a.createElement(b.a,{style:{marginTop:5}},"TxHash: ",e.txhash),e.tx.value.memo?n.a.createElement(b.a,{style:{marginTop:5}},e.tx.value.memo):null,n.a.createElement(b.a,{variant:"caption",style:{marginTop:5}},q()(e.timestamp).format()),n.a.createElement(D.a,null))}class M extends n.a.PureComponent{constructor(e){super(e),this.state={refreshing:!1,txs:[]}}async componentDidMount(){this.loadTxs(this.props.address)}async loadTxs(e,t=20,a=1){this.setState({txs:[],refreshing:!0});let s=[];s=s.concat(await this.queryTxs(e,"message.sender",t,a)),s.forEach(e=>{delete e.raw_log}),this.setState({txs:s,refreshing:!1})}async queryTxs(e,t="message.sender",a=20,s=1){try{let n=`${t}=${e}`,r=`${this.context.config.server_url}/api/${this.context.appInfo._id}/asskey/txs?${n}&limit=${a}&page=${s}&access_token=${this.context.userInfo.token}`;return JSON.parse(await this.context.apis.asyncGet(r)).txs}catch(e){return[]}}clickTx(e){this.props.onClick&&this.props.onClick(e)}render(){return n.a.createElement($.a,null,this.state.txs.map(e=>n.a.createElement(L.a,{button:!0,key:e.txhash,style:{width:"100%"},onClick:()=>this.clickTx(e)},n.a.createElement(F,{tx:e}))))}}M.contextType=y.a;class j extends n.a.PureComponent{constructor(e){super(e),this.state={refreshing:!1,txs:[]}}async componentDidMount(){this.loadTxs(this.props.address)}clickTx(e){this.props.onClick&&this.props.onClick(e)}async loadTxs(e,t=20,a=1){this.setState({txs:[],refreshing:!0});let s=[];s=s.concat(await this.queryTxs(e,"transfer.recipient",t,a)),s.forEach(e=>{delete e.raw_log}),this.setState({txs:s,refreshing:!1})}async queryTxs(e,t="message.sender",a=20,s=1){try{let n=`${t}=${e}`,r=`${this.context.config.server_url}/api/${this.context.appInfo._id}/asskey/txs?${n}&limit=${a}&page=${s}&access_token=${this.context.userInfo.token}`;return JSON.parse(await this.context.apis.asyncGet(r)).txs}catch(e){return[]}}render(){return n.a.createElement($.a,{style:{padding:10}},this.state.txs.map(e=>n.a.createElement(L.a,{button:!0,key:e.txhash,style:{width:"100%"},onClick:()=>this.clickTx(e)},n.a.createElement(F,{tx:e}))))}}j.contextType=y.a;class N extends n.a.PureComponent{constructor(e){super(e),this.state={dialogOpen:!1,ReactJson:null},this.open=this.open.bind(this)}async componentDidMount(){const{default:e}=await a.e(0).then(a.t.bind(null,1424,7));this.setState({ReactJson:e})}open(e){this.setState({currTx:e,dialogOpen:!0})}render(){return n.a.createElement(m.a,{fullScreen:!1,fullWidth:!0,maxWidth:"md",open:this.state.dialogOpen,onClose:()=>this.setState({dialogOpen:!1})},n.a.createElement(g.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},n.a.createElement(u.a,{container:!0,direction:"row",justify:"space-between"},n.a.createElement(u.a,{item:!0},n.a.createElement(b.a,{variant:"subtitle1"},this.context.apis.getLabel("Chi tiết giao dịch")),n.a.createElement(b.a,{variant:"caption"},this.state.currTx?this.state.currTx.txhash:"")),n.a.createElement(u.a,{item:!0},n.a.createElement(o.a,{onClick:()=>this.setState({dialogOpen:!1}),color:"secondary"},"Close")))),n.a.createElement(p.a,{style:{padding:0}},this.state.currTx&&this.state.ReactJson?n.a.createElement(this.state.ReactJson,{src:{result:this.state.currTx.logs,transaction:this.state.currTx.tx.value,timestamp:this.state.currTx.timestamp},theme:"apathy:inverted",enableClipboard:!1,name:"Detail transaction",displayObjectSize:!1,displayDataTypes:!1}):null))}}N.contextType=y.a;class H extends n.a.PureComponent{constructor(e){super(e),this.state={load:0,currentTab:0,dialogOpen:!1,dialogOpenList:!1,address:""},this.open=this.open.bind(this),this.close=this.close.bind(this)}open(e){this.setState({address:e,dialogOpenList:!0})}close(){this.setState({address:"",dialogOpenList:!1})}showDetail(e){this._detail.open(e)}render(){let{address:e}=this.state;return!!e&&n.a.createElement("div",null,n.a.createElement(m.a,{fullScreen:!0,fullWidth:!0,maxWidth:"lg",open:this.state.dialogOpenList,onClose:this.close},n.a.createElement(g.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},n.a.createElement(u.a,{container:!0,alignItems:"center",spacing:1},n.a.createElement(u.a,{item:!0,style:{flexGrow:1}},n.a.createElement(b.a,{variant:"h3"},this.context.apis.getLabel("Các giao dịch")),n.a.createElement(b.a,{variant:"body1"},e)),n.a.createElement(u.a,{item:!0},n.a.createElement(o.a,{onClick:this.close,color:"secondary"},"Close")))),n.a.createElement(p.a,{style:{padding:0}},n.a.createElement(c.a,{elevation:0,position:"static",color:"default"},n.a.createElement(h.a,{value:this.state.currentTab,onChange:(e,t)=>this.setState({currentTab:t})},n.a.createElement(d.a,{label:this.context.apis.getLabel("Gửi")}),n.a.createElement(d.a,{label:this.context.apis.getLabel("Nhận")}))),0===this.state.currentTab&&n.a.createElement(M,{address:e,onClick:e=>this.showDetail(e)}),1===this.state.currentTab&&n.a.createElement(j,{address:e,onClick:e=>this.showDetail(e)}))),n.a.createElement(N,{ref:e=>this._detail=e}))}}H.contextType=y.a;var J=H;function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}class R extends n.a.PureComponent{constructor(e){super(e),this.transfer=this.transfer.bind(this),this.getBalanceWallet=this.getBalanceWallet.bind(this),this.showTransactions=this.showTransactions.bind(this),this.delete=this.delete.bind(this),this.state={balance:[],load:0}}componentDidMount(){this.getBalanceWallet(),P.EmitEvents.subscribe("account.changed:"+this.props.wallet.address,e=>{this.getBalanceWallet()})}componentWillUnmount(){P.EmitEvents.unsubscribe("account.changed:"+this.props.wallet.address)}transfer(e,t){this.props.transferFrom.showForm(e,t,{},e=>{T.b.info(this.context.apis.getLabel("Giao dịch của bạn đang được thực hiện"),{autoClose:1e3,hideProgressBar:!0}),this.getBalanceWallet()})}delete(e){this.props.onDelete&&this.props.onDelete(e)}async getBalanceWallet(){let e=`${this.context.config.server_url}/api/${this.props.wallet.id_app}/asskey/${this.props.wallet.address}/balance?access_token=${this.props.userInfo.token}`;try{let t=JSON.parse(await this.context.apis.asyncGet(e));this.setState({balance:t,load:this.state.load+1})}catch(e){console.log(e.message)}}showTransactions(e){this.props.onShowTransactions&&this.props.onShowTransactions(e)}render(){return n.a.createElement(v.a,{style:{marginBottom:10}},n.a.createElement(C.a,null,n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement("div",{style:{flex:1}},n.a.createElement(b.a,{variant:"subtitle1"},this.context.apis.getLabel("Địa chỉ"),": "),n.a.createElement(b.a,{variant:"body1"},this.props.wallet.address)),n.a.createElement(o.a,{onClick:()=>this.delete(this.props.wallet),style:{color:this.context.config.mainColor}},this.context.apis.getLabel("Xoá"))),this.state.balance.map(e=>n.a.createElement("div",{style:{marginTop:10,display:"flex",alignItems:"center",border:"1px solid #dddddd",borderRadius:3,padding:10},key:e.denom},n.a.createElement(b.a,{variant:"subtitle2",style:{flex:1}},k()(e.amount).format()," ",e.denom),n.a.createElement(o.a,{size:"small",onClick:()=>this.showTransactions(this.props.wallet.address),style:{marginRight:5,marginLeft:20,color:this.context.config.mainColor}},this.context.apis.getLabel("Các giao dịch")),n.a.createElement(o.a,{size:"small",style:{marginRight:5,color:this.context.config.mainColor},onClick:()=>this.transfer(this.props.wallet,e.denom)},this.context.apis.getLabel("Chuyển token"))))))}}R.contextType=y.a;class A extends n.a.Component{constructor(e){super(e),this.state={}}async componentDidMount(){}async deleteKey(e){this._list.deleteItem(e)}showTransactions(e){this._transactions.open(e)}render(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(O.default,G({fullScreen:!1,hideHeader:!0,readOnly:!1,code:"asskey",defaultData:{username:this.context.userInfo.email},defaultCondition:{username:this.context.userInfo.email},defaultOptionsCode:"default_list_options",ref:e=>this._list=e},this.props,{renderItems:({rows:e})=>n.a.createElement("div",{style:{overflow:"auto",padding:10,backgroundColor:"#dddddd"}},e.map(e=>n.a.createElement(R,{wallet:e,key:e._id,userInfo:this.context.userInfo,onDelete:e=>this.deleteKey(e),onShowTransactions:e=>this.showTransactions(e),transferFrom:this.transferFrom})),n.a.createElement(W,{ref:e=>this.transferFrom=e}))})),n.a.createElement(J,{ref:e=>this._transactions=e}))}}A.contextType=y.a;var z=A;const V=a(208),K={paper:{margin:10,display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%"}};class U extends n.a.Component{constructor(e){super(e),this.state={refreshing:!1,dialogOpen:!1,email:"",password:"",rePassword:"",currentPassword:"",address:"",phone:"",name:"",currentTab:0,changePasswordSuccess:"",errorChangePassword:"",error:"",updateSuccess:""},this.submit=this.submit.bind(this),this.changePassword=this.changePassword.bind(this),this.showForm=this.showForm.bind(this)}async componentDidMount(){}showForm(e){let t={refreshing:!1,dialogOpen:!0,email:this.context.userInfo.email,password:"",rePassword:"",currentPassword:"",address:this.context.userInfo.address,phone:this.context.userInfo.phone,name:this.context.userInfo.name,picture:this.context.userInfo.picture,currentTab:0,changePasswordSuccess:"",errorChangePassword:"",error:"",updateSuccess:""};this.setState(t),this.onSuccess=e}handleClose(){this.setState({dialogOpen:!1})}async changePassword(){const{getLabel:e,asyncChangePassword:t}=this.context.apis;let a={newPassword:this.state.password,reNewPassword:this.state.rePassword,oldPassword:this.state.currentPassword};if(a.newPassword)if(a.newPassword===a.reNewPassword){this.setState({changePasswordSuccess:"",errorChangePassword:"",running:!0});try{await t(this.context.userInfo.token,a),this.setState({changePasswordSuccess:e("Bạn đã thay đổi mật khẩu thành công"),running:!1})}catch(e){this.setState({errorChangePassword:e.message,running:!1})}}else this.setState({errorChangePassword:e("Hai mật khẩu không khớp nhau")});else this.setState({errorChangePassword:e("Bạn chưa cập nhật mật khẩu mới")})}async submit(){const{getLabel:e}=this.context.apis;let t={name:this.state.name,address:this.state.address,phone:this.state.phone},a={name:{presence:{allowEmpty:!1,message:"^"+e("Bạn chưa nhập họ và tên đầy đủ")}},address:{presence:{allowEmpty:!0,message:"^"+e("Bạn chưa nhập địa chỉ")}},phone:{presence:{allowEmpty:!0,message:"^"+e("Bạn chưa nhập số điện thoại để liên hệ")}}},s=V(t,a,{format:"flat"});if(s){let e=s.join("<br/>");return void this.setState({error:e,running:!1,updateSuccess:""})}this.setState({running:!0,error:"",updateSuccess:""});let n=this.context.config.server_url+"/api/updateprofile";try{await this.context.asyncPost(this.context.userInfo.token,n,null,t,"POST","updateProfile");let a=Object.assign(this.context.userInfo,t);this.setState({updateSuccess:e("Đã cập nhật thành công"),running:!1}),this.onSuccess&&this.onSuccess(a)}catch(e){this.setState({error:e.message,running:!1})}}dialog(){const{getLabel:e}=this.context.apis,{mainTextColor:t,formHeaderColor:a}=this.context.config;return n.a.createElement(m.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"sm",open:this.state.dialogOpen,onClose:()=>this.handleClose()},n.a.createElement(g.a,{style:{backgroundColor:a,color:t}},n.a.createElement(u.a,{container:!0,direction:"row",justify:"space-between"},n.a.createElement(u.a,{item:!0},e("Tài khoản của tôi")),n.a.createElement(u.a,{item:!0},n.a.createElement(o.a,{onClick:()=>this.handleClose(),style:{color:t}},n.a.createElement(f.a,{style:{color:"silver"}}))))),n.a.createElement(p.a,{style:{padding:0}},n.a.createElement(c.a,{position:"static",color:"default"},n.a.createElement(h.a,{value:this.state.currentTab,onChange:(e,t)=>this.setState({currentTab:t})},n.a.createElement(d.a,{label:e("Thông tin tài khoản")}),n.a.createElement(d.a,{label:e("Đổi mật khẩu")}),!!this.context.config.USE_BLOCKCHAIN&&n.a.createElement(d.a,{label:e("Ví coins")}))),0===this.state.currentTab&&n.a.createElement("div",null,n.a.createElement("div",{style:K.paper},n.a.createElement("form",{style:K.form,noValidate:!0},n.a.createElement("div",{style:{display:"flex",justifyContent:"center",margin:10}},n.a.createElement(o.a,{size:"small",component:"label"},n.a.createElement(E.a,{style:{width:128,height:128},src:`${this.state.picture?0===this.state.picture.indexOf("http")?this.state.picture:this.context.config.server_url+this.state.picture:"/images/avatar.png"}`}),n.a.createElement("input",{type:"file",style:{display:"none"},onChange:e=>{const t=e.target.files;if(t.length>0){let e=`${this.context.config.server_url}/api/uploadfile?json=1&folder=avatars&access_token=${this.context.userInfo.token}`;this.context.setProgressStatus(!0),this.context.apis.uploadFile(e,t[0],(e,t)=>{if(this.context.setProgressStatus(!1),e)return this.context.alert(e.message);t=JSON.parse(t),this.context.userInfo.picture=t.fileUrl,this.setState({picture:this.context.userInfo.picture})})}}}))),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:e("Email"),value:this.state.email,InputProps:{readOnly:!0}}),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"name",label:e("Họ và tên đầy đủ"),value:this.state.name,onChange:e=>this.setState({name:e.target.value})}),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!1,fullWidth:!0,id:"address",label:e("Địa chỉ"),value:this.state.address,onChange:e=>this.setState({address:e.target.value})}),n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!1,fullWidth:!0,id:"phone",label:e("Điện thoại"),value:this.state.phone,onChange:e=>this.setState({phone:e.target.value})}),this.state.error?n.a.createElement("div",{style:{color:"red",textAlign:"center",padding:10},dangerouslySetInnerHTML:{__html:this.state.error}}):null,this.state.updateSuccess?n.a.createElement("div",{style:{color:"green",textAlign:"center",padding:10}},this.state.updateSuccess):null,n.a.createElement(o.a,{type:"Button",fullWidth:!0,variant:"contained",color:"secondary",style:K.submit,disabled:this.state.running,onClick:this.submit},e("Cập nhật"))))),1===this.state.currentTab&&n.a.createElement("div",null,n.a.createElement("div",{style:K.paper},n.a.createElement("form",{style:K.form,noValidate:!0},n.a.createElement(l.a,{variant:"outlined",margin:"normal",required:!1,fullWidth:!0,label:e("Mật khẩu hiện tại"),helperText:e("Nếu tài khoản này có mật khẩu, hãy nhập tài khoản hiện tại."),type:"password",id:"password",value:this.state.currentPassword,onChange:e=>this.setState({currentPassword:e.target.value})}),n.a.createElement(l.a,{error:this.state.password&&this.state.password.length<6,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:e("Mật khẩu mới"),helperText:this.state.password&&this.state.password.length<6?e("Mật khẩu phải từ 6 ký tự trở lên"):null,type:"password",id:"newpassword",value:this.state.password,onChange:e=>this.setState({password:e.target.value})}),n.a.createElement(l.a,{error:this.state.password&&this.state.rePassword&&this.state.password!==this.state.rePassword,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:e("Nhắc lại mật khẩu mới"),type:"password",id:"repassword",value:this.state.rePassword,helperText:this.state.password&&this.state.rePassword&&this.state.password!==this.state.rePassword?e("Hai mật khẩu phải giống nhau"):null,onChange:e=>this.setState({rePassword:e.target.value})}),this.state.errorChangePassword?n.a.createElement("div",{style:{color:"red",textAlign:"center",padding:10}},this.state.errorChangePassword):null,this.state.changePasswordSuccess?n.a.createElement("div",{style:{color:"green",textAlign:"center",padding:10}},this.state.changePasswordSuccess):null,n.a.createElement(o.a,{type:"Button",fullWidth:!0,variant:"contained",color:"secondary",disabled:this.state.running,onClick:this.changePassword},e("Đổi mật khẩu"))))),2===this.state.currentTab&&n.a.createElement("div",null,n.a.createElement(z,null))))}render(){return this.dialog()}}U.contextType=y.a,U.propTypes={mediaQueryMatches:i.a.bool};t.default=Object(w.a)("(max-width:480px)")(U)}}]);