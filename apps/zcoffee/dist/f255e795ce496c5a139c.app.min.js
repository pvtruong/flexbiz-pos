(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1430:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(605),o=n(218),l=n(120),c=n.n(l),s=n(280),d=n(371),u=n(372),h=n(606),f=n(217),p=n(1),m=n.n(p),_=n(378),y=n(196),g=n(1209),b=n(9),k=n(18),v=n(161);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(p,e);var t,n,a,l=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var n,a=L(e);if(t()){var i=L(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return S(this,n)}}(p);function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=l.call(this,e)).handleValueChanged=t.handleValueChanged.bind(w(t)),t.handleTyLeCkChanged=t.handleTyLeCkChanged.bind(w(t)),t.handleTienCkChanged=t.handleTienCkChanged.bind(w(t)),t.state={load:0,open:t.props.open,disabled_discount:!0,data:{},kho:null},t}return t=p,(n=[{key:"open",value:function(e,t,n){this.callback=n,this.setState({data:e,kho:t,open:!0,disabled_discount:!0})}},{key:"close",value:function(){this.setState({open:!1})}},{key:"save",value:function(){if(!(this.state.data||{}).ma_ban)return this.context.alert(this.context.apis.getLabel("Bạn phải chọn một bàn"));this.callback&&this.callback(this.state.data),this.setState({open:!1,disabled_discount:!0})}},{key:"handleValueChanged",value:function(e){var t=this.state.data;for(var n in e)t[n]=e[n];this.setState({data:t,load:this.state.load+1})}},{key:"handleTyLeCkChanged",value:function(e){var t=this.state.data,n=(t.details||[]).map((function(e){return(e.tien_hang_nt||0)-(e.tien_ck_nt||0)})).reduce((function(e,t){return e+t}),0);t.ty_le_ck_hd=e,t.tien_ck_hd=Math.round(n*t.ty_le_ck_hd/100,0),t.t_ck_nt=t.tien_ck_hd+(t.details||[]).map((function(e){return e.tien_ck_nt})).reduce((function(e,t){return e+t}),0),this.setState({data:t,load:this.state.load+1})}},{key:"handleTienCkChanged",value:function(e){console.log("tien ck hd changed",e);var t=this.state.data;t.tien_ck_hd=Number(e),t.ty_le_ck_hd=0,t.t_ck_nt=t.tien_ck_hd+(t.details||[]).map((function(e){return e.tien_ck_nt})).reduce((function(e,t){return e+t}),0),this.setState({data:t,load:this.state.load+1})}},{key:"editDiscount",value:function(){var e=this,t=this.state,n=t.kho,a=t.data;if(!n.user_quan_ly)return this.context.alert(this.context.apis.getLabel("Chưa khai báo người quản lý cho cửa hàng này"));var i={time:new Date,id_app:this.context.config.id_app};this.context.sign("Nhập mật khẩu để ký xác nhận thay đổi chiết khấu",n.user_quan_ly,i,(function(t){a.sign_user=n.user_quan_ly,a.sign_data=i,a.signature=t,e.setState({disabled_discount:!1})}))}},{key:"render",value:function(){var e=this;if(!this.state.open)return null;var t=this.state,n=t.data,a=t.disabled_discount,l=[{type:"String",maxlength:32,required:!0,name:"ma_ban",header:"Bàn",ref_model:"dmban",ref_field:"ma_ban",ref_label:"ten_ban",ref_condition:'{"ma_kho":"'.concat(n.ma_kho,'"}'),html_component_input:"picker"},{type:"String",maxlength:32,required:!1,name:"ma_kh",header:"Khách hàng",ref_model:"customer",ref_field:"ma_kh",ref_label:"ten_kh"},{type:"String",maxlength:1024,required:!1,name:"ong_ba",header:"Người giao dịch"},{type:"Number",required:!0,name:"so_khach",header:"Số khách"},{type:"String",maxlength:1024,required:!1,name:"dien_giai",header:"Ghi chú",grid_configs:"{lg:12,md:12}",html_component_input:"textarea"}];return i.a.createElement(d.a,{maxWidth:"sm",fullWidth:!0,open:this.state.open},i.a.createElement(h.a,{style:{backgroundColor:k.formHeaderColor,color:k.mainTextColor}},i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{flexGrow:1}},i.a.createElement(s.a,null,this.state.title||this.context.apis.getLabel("Cập nhật phiếu"))),i.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",paddingLeft:10}},i.a.createElement(r.a,{style:{marginLeft:5},onClick:function(){return e.setState({open:!1})}},i.a.createElement(c.a,{style:{color:"silver"}}))))),i.a.createElement(u.a,{style:{padding:0}},i.a.createElement(f.a,{style:{margin:10,padding:10}},i.a.createElement("div",null,i.a.createElement(v.default,{fields:l,master:n,data:n,handleValueChanged:this.handleValueChanged.bind(this)}))),i.a.createElement(f.a,{style:{margin:10,padding:10}},i.a.createElement(y.a,{container:!0},i.a.createElement(y.a,{item:!0},i.a.createElement(g.a,{margin:"normal",variant:"standard",type:"text",id:"ty_le_ck_hd",label:this.context.apis.getLabel("Tỷ lệ CK hoá đơn"),value:n.ty_le_ck_hd,disabled:a,InputLabelProps:{shrink:!0},InputProps:{inputComponent:_.a},onChange:function(t){return e.handleTyLeCkChanged(Number(t.target.value))}})),i.a.createElement(y.a,{item:!0,style:{flexGrow:1,paddingLeft:10,paddingRight:10}},i.a.createElement(g.a,{fullWidth:!0,margin:"normal",variant:"standard",type:"text",id:"tien_ck_hd",label:this.context.apis.getLabel("Tiền chiết khấu hoá đơn"),value:n.tien_ck_hd,disabled:a,InputLabelProps:{shrink:!0},InputProps:{inputComponent:_.a},onChange:function(t){return e.handleTienCkChanged(t.target.value)}})),a&&i.a.createElement(y.a,{item:!0,style:{display:"flex",alignItems:"flex-end"}},i.a.createElement(o.a,{variant:"contained",onClick:this.editDiscount.bind(this)},this.context.apis.getLabel("Sửa"))))),i.a.createElement("div",{style:{display:"flex",justifyContent:"center",padding:10}},i.a.createElement(o.a,{variant:"contained",color:"secondary",onClick:this.save.bind(this)},this.context.apis.getLabel("Lưu")))))}}])&&x(t.prototype,n),a&&x(t,a),p}(a.PureComponent);T.contextType=b.a,T.propTypes={open:m.a.bool},t.default=T}}]);