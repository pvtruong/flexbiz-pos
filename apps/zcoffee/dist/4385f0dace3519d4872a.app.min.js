(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1435:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(1),i=n.n(o),c=n(218),u=n(196),l=n(120),s=n.n(l),h=n(280),p=n(371),f=n(372),m=n(606),d=n(1209),y=n(1182),v=n(1208),_=n(9),g=n(18),b=n(380),k=n(22),x=n.n(k),E=n(378),w=n(57),C=n(605),S=n(256),P=n.n(S),O=n(1190),R=n(1192),j=n(43),L=n.n(j);function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function D(t,e,n,a,r,o,i){try{var c=t[o](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(a,r)}function T(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var o=t.apply(e,n);function i(t){D(o,a,r,i,c,"next",t)}function c(t){D(o,a,r,i,c,"throw",t)}i(void 0)}))}}function W(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(s,t);var e,a,o,i,u,l=function(t){function e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}return function(){var n,a=V(t);if(e()){var r=V(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return A(this,n)}}(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=l.call(this,t)).state={data:e.props.data||[]},e}return e=s,(a=[{key:"componentDidMount",value:(u=T(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return u.apply(this,arguments)})},{key:"componentDidUpdate",value:function(t){L()(t.data,this.props.data)||this.setState({data:this.props.data})}},{key:"addEvoucher",value:(i=T(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){T(regeneratorRuntime.mark((function a(){var o,i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.refEvoucherForm){a.next=8;break}return a.next=3,n.e(20).then(n.bind(null,1432));case 3:o=a.sent,i=o.default,e.setState({EvoucherForm:r.a.createElement(i,{ref:function(t){return e.refEvoucherForm=t}})},(function(){t()})),a.next=9;break;case 8:t();case 9:case"end":return a.stop()}}),a)})))()}));case 2:this.refEvoucherForm.open(this.context.apis.getLabel("Nhập mã phiếu giảm giá"),this.props.ma_kh,(function(t){var n=e.state.data;n.find((function(e){return e.ma===t.ma}))||(n=[].concat(F(n),[t]),e.setState({data:n}),e.props.onDataChange&&e.props.onDataChange(n))}));case 3:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"removeEvoucher",value:function(t){var e=this.state.data.filter((function(e){return e.ma!==t.ma}));this.setState({data:e}),this.props.onDataChange&&this.props.onDataChange(e)}},{key:"render",value:function(){var t=this;return(r.a.createElement("div",null,this.state.data.map((function(e){return r.a.createElement(O.a,{key:e.ma,style:{marginBottom:3}},r.a.createElement(R.a,{style:{padding:5}},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("div",null,r.a.createElement(h.a,{variant:"body1"},"".concat(x()(e.so_tien).format()," đ")||!1),r.a.createElement(h.a,{variant:"caption"},e.ma," - ",e.ten)),r.a.createElement(C.a,{onClick:function(){return t.removeEvoucher(e)},style:{marginLeft:5}},r.a.createElement(P.a,null)))))})),r.a.createElement(c.a,{variant:"outlined",color:"primary",onClick:this.addEvoucher.bind(this)},this.context.apis.getLabel("+ Thêm phiếu giảm giá")),this.state.EvoucherForm))}}])&&W(e.prototype,a),o&&W(e,o),s}(a.Component);M.contextType=_.a,M.propTypes={mediaQueryMatches:i.a.bool,data:i.a.array,ma_kh:i.a.string,onDataChange:i.a.func};var q=M;function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function G(t,e,n,a,r,o,i){try{var c=t[o](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(a,r)}function B(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var o=t.apply(e,n);function i(t){G(o,a,r,i,c,"next",t)}function c(t){G(o,a,r,i,c,"throw",t)}i(void 0)}))}}function Q(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function U(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?K(t):e}function K(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(_,t);var e,n,a,o,i,l=function(t){function e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}return function(){var n,a=X(t);if(e()){var r=X(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return U(this,n)}}(_);function _(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,_),(e=l.call(this,t)).handleValueChanged=e.handleValueChanged.bind(K(e)),e.state={open:!1,voucher:{}},e.currentField="tien_thu",e}return e=_,(n=[{key:"componentDidMount",value:(i=B(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"open",value:(o=B(regeneratorRuntime.mark((function t(e,n,a){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.callback=n,e.tien_thu=0,e.tien_thu2=0,this.calcConNo(e),this.mediaQueryMatches=a,e.phai_tra=0,e.pt_thanh_toan){t.next=27;break}return t.prev=7,t.next=10,this.context.apis.asyncGetData(this.context.userInfo.token,"options",{id_func:"pbl"},"option",!0);case 10:if(t.t0=t.sent,t.t0){t.next=13;break}t.t0={};case 13:if(!(r=t.t0).pt_thanh_toan){t.next=18;break}e.pt_thanh_toan=r.pt_thanh_toan,t.next=22;break;case 18:return t.next=20,this.context.apis.asyncGetData(this.context.userInfo.token,"ptthanhtoan",null,"_id",!0);case 20:(o=t.sent)&&(e.pt_thanh_toan=o);case 22:t.next=27;break;case 24:t.prev=24,t.t1=t.catch(7),console.error(t.t1.message);case 27:this.setState({voucher:e,open:!0});case 28:case"end":return t.stop()}}),t,this,[[7,24]])}))),function(t,e,n){return o.apply(this,arguments)})},{key:"close",value:function(){this.setState({open:!1})}},{key:"cancel",value:function(){var t=this;this.context.alert(this.context.apis.getLabel("Có chắc chắn huỷ phiếu này không?"),(function(){var e=t.state.voucher;e.trang_thai="9",t.callback&&t.callback(e),t.setState({open:!1})}))}},{key:"payment",value:function(){var t=this.state.voucher;return t.pt_thanh_toan?t.con_no?this.context.alert(this.context.apis.getLabel("Số tiền nhận chưa đủ")):(t.trang_thai="5",t.cashier=this.context.userInfo.email,t.payment_time=new Date,this.callback&&this.callback(t),void this.setState({open:!1})):this.context.alert(this.context.apis.getLabel("Hãy chọn một phương thức thanh toán"))}},{key:"calcConNo",value:function(t){t.tien_evoucher=(t.evouchers||[]).map((function(e){var n=e.ty_le?Math.roundBy(t.t_tien_nt*e.ty_le/100,0):e.so_tien;return e.so_tien_max&&n>e.so_tien_max&&(n=e.so_tien_max),e.so_tien_giam=n,n})).reduce((function(t,e){return t+e}),0),t.t_ck_nt=t.details.map((function(t){return t.tien_ck_nt})).reduce((function(t,e){return t+e}),0)+(t.tien_ck_hd||0)+(t.tien_evoucher||0),t.t_tt_nt=t.t_tien_nt-t.t_ck_nt,t.con_no=t.t_tt_nt-t.tien_thu-t.tien_thu2-(t.tien_paymentByPoints||0),t.con_no<0?(t.phai_tra=Math.abs(t.con_no),t.con_no=0):t.phai_tra=0}},{key:"handleEvouchersChange",value:function(t){var e=this.state.voucher;e.evouchers=z(t),this.calcConNo(e),this.setState({voucher:e}),this.props.onEvouchersChange&&this.props.onEvouchersChange(t)}},{key:"handleValueChanged",value:function(t){var e=this.state.voucher;for(var n in t)e[n]=t[n];0===e.tien_thu&&e.tien_thu2,this.calcConNo(e),this.setState({voucher:e})}},{key:"add",value:function(t){var e=this.state.voucher;if(this.currentField){var n=e[this.currentField]+t,a=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},this.currentField,n);this.handleValueChanged(a)}}},{key:"render",value:function(){var t=this;if(!this.state.open)return null;var e=this.state.voucher;return(r.a.createElement(p.a,{maxWidth:"md",open:this.state.open,onClose:this.close.bind(this)},r.a.createElement(m.a,{style:{backgroundColor:g.formHeaderColor,color:g.mainTextColor}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(h.a,null,this.context.apis.getLabel("Thanh toán"))),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",paddingLeft:10}},r.a.createElement(c.a,{variant:"contained",color:"secondary",onClick:this.payment.bind(this)},this.context.apis.getLabel("Thanh toán")),r.a.createElement(c.a,{variant:"contained",color:"secondary",style:{marginLeft:5},onClick:function(){return t.setState({open:!1})}},r.a.createElement(s.a,null))))),r.a.createElement(f.a,{style:{padding:10}},r.a.createElement(u.a,{container:!0,spacing:2},r.a.createElement(u.a,{item:!0,md:8,lg:8},r.a.createElement(d.a,{margin:"normal",fullWidth:!0,type:"text",label:this.context.apis.getLabel("Tổng tiền phải thanh toán"),value:e.t_tt_nt,InputLabelProps:{shrink:!0},InputProps:{readOnly:!0,inputComponent:E.a,style:{fontSize:18,color:g.mainColor}}}),r.a.createElement(y.a,{margin:"normal",fullWidth:!0,required:!0},r.a.createElement(v.a,{shrink:!0},this.context.apis.getLabel("Phương thức thanh toán")),r.a.createElement(b.a,{fullWidth:!0,required:!0,value:e.pt_thanh_toan,valueField:"_id",labelField:"ten",items:function(){var e=B(regeneratorRuntime.mark((function e(n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.context.userInfo.token,r="".concat(g.server_url,"/api"),r="".concat(r,"/").concat(g.id_app,"/").concat("ptthanhtoan","?access_token=").concat(a),n&&(r="".concat(r,"&q=").concat(JSON.stringify(n),"&fields=ten")),e.t0=JSON,e.next=8,t.context.apis.asyncGet(r,null,{cache:!0});case 8:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onValueChanged:function(e){t.handleValueChanged({pt_thanh_toan:e})}})),r.a.createElement(d.a,{margin:"normal",fullWidth:!0,type:"text",label:this.context.apis.getLabel("Số tiền nhận"),value:e.tien_thu,InputLabelProps:{shrink:!0},InputProps:{inputComponent:E.a,style:{fontSize:24}},onFocus:function(){t.currentField="tien_thu"},onChange:function(e){return t.handleValueChanged({tien_thu:Number(e.target.value)})}}),(e.con_no>0&&e.tien_thu>0||e.tien_thu2>0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(y.a,{margin:"normal",fullWidth:!0,required:!0},r.a.createElement(v.a,{shrink:!0},this.context.apis.getLabel("Phương thức thanh toán khác")),r.a.createElement(b.a,{fullWidth:!0,required:!0,value:e.pt_thanh_toan2,valueField:"_id",labelField:"ten",items:function(){var e=B(regeneratorRuntime.mark((function e(n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.context.userInfo.token,r="".concat(g.server_url,"/api"),r="".concat(r,"/").concat(g.id_app,"/").concat("ptthanhtoan","?access_token=").concat(a),n&&(r="".concat(r,"&q=").concat(JSON.stringify(n),"&fields=ten")),e.t0=JSON,e.next=8,t.context.apis.asyncGet(r,null,{cache:!0});case 8:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onValueChanged:function(e){t.handleValueChanged({pt_thanh_toan2:e})}})),!!e.pt_thanh_toan2&&r.a.createElement(d.a,{margin:"normal",fullWidth:!0,type:"text",label:this.context.apis.getLabel("Số tiền nhận khác"),value:e.tien_thu2,InputLabelProps:{shrink:!0},InputProps:{inputComponent:E.a,style:{fontSize:32}},onFocus:function(){t.currentField="tien_thu2"},onChange:function(e){return t.handleValueChanged({tien_thu2:Number(e.target.value)})}})),e.con_no>0&&e.tien_thu>0&&r.a.createElement(d.a,{margin:"normal",fullWidth:!0,type:"text",label:this.context.apis.getLabel("Còn thiếu"),value:e.con_no,InputLabelProps:{shrink:!0},InputProps:{readOnly:!0,inputComponent:E.a,style:{fontSize:24}}}),e.phai_tra>0&&r.a.createElement(d.a,{margin:"normal",fullWidth:!0,type:"text",label:this.context.apis.getLabel("Phải trả lại"),value:e.phai_tra,InputLabelProps:{shrink:!0},InputProps:{readOnly:!0,inputComponent:E.a,style:{fontSize:24}}})),r.a.createElement(u.a,{item:!0,md:4,lg:4},!this.mediaQueryMatches&&r.a.createElement(w.a,{title:this.context.apis.getLabel("Chọn mệnh giá")},r.a.createElement(u.a,{container:!0,spacing:2,justify:"space-between"},[5e3,1e4,2e4,5e4,1e5,2e5,5e5,1e6,2e6].map((function(e){return r.a.createElement(u.a,{item:!0,md:4,lg:4,key:e.toString()},r.a.createElement(c.a,{fullWidth:!0,onClick:function(){return t.add(e)},variant:"contained"},x()(e).format()))})),r.a.createElement(u.a,{item:!0,md:6,lg:6},r.a.createElement(c.a,{fullWidth:!0,color:"secondary",onClick:function(){return t.add(e.t_tt_nt)},variant:"contained"},x()(e.t_tt_nt).format())),!!e.con_no&&e.con_no!==e.t_tt_nt&&r.a.createElement(u.a,{item:!0,md:6,lg:6},r.a.createElement(c.a,{fullWidth:!0,color:"secondary",onClick:function(){return t.add(e.con_no)},variant:"contained"},x()(e.con_no).format())))),r.a.createElement(w.a,{title:this.context.apis.getLabel("Phiếu giảm giá")},r.a.createElement(q,{data:this.state.voucher.evouchers,ma_kh:this.state.voucher.ma_kh,onDataChange:this.handleEvouchersChange.bind(this)})))))))}}])&&Q(e.prototype,n),a&&Q(e,a),_}(a.Component);Y.contextType=_.a,Y.propTypes={onEvouchersChange:i.a.func};e.default=Y}}]);