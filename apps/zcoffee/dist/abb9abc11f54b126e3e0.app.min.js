(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1413:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(1),l=a.n(r),c=a(280),s=a(218),o=a(1203),h=a(217),m=a(1184),d=a(196),g=a(371),u=a(372),p=a(606),_=a(9),E=a(40),y=a(120),f=a.n(y),k=a(8),w=a.n(k);class x extends i.a.Component{constructor(e){super(e),this.state={dialogOpen:!1,menu:[],groups:[],selectedGroup:null,dialogTrangThaiOpen:!1},this.showForm=this.showForm.bind(this),this.showTrangThai=this.showTrangThai.bind(this)}async componentDidMount(){}async loadright(e){const{asyncGetList:t,asyncGetMenu:a}=this.context.apis;this.context.setProgressStatus(!0);try{this.cac_trang_thai=await t(this.context.userInfo.token,"trangthai",{limit:3e4});const n=(await a(this.context.userInfo.token,e)).filter(e=>!e.system&&"home"!==e.code);n.forEach(e=>{e.cac_trang_thai_phan_quyen=[...this.cac_trang_thai.filter(t=>t.ma_ct.toUpperCase()===e.api_code.toUpperCase())]});const i=[...new Set(n.filter(e=>!e.mother_module).map(e=>e.group))],r=i.length>0?i[0]:null;this.setState({menu:n,groups:i,selectedGroup:r}),this.context.setProgressStatus(!1)}catch(e){console.error(this.context.userInfo),this.context.alert(e.message)}}async showForm(e,t=""){this.setState({dialogOpen:!0,group_id:e,group_name:t,menu:[],groups:[],selectedGroup:null},()=>{this.loadright(e)})}showTrangThai(e,t){const a=[...this.cac_trang_thai.filter(t=>t.ma_ct.toUpperCase()===e.api_code.toUpperCase())];a.forEach(a=>{console.log(e[`${t}_trang_thai`],a.ma_trang_thai),a.check=(e[`${t}_trang_thai`]||{})[a.ma_trang_thai],null==a.check&&(a.check=!0)}),e[`cac_trang_thai_phan_quyen_${t}`]=a,this.setState({currentItem:e,currentRight:t,dialogTrangThaiOpen:!0})}handleClose(){this.setState({dialogOpen:!1})}cancel(){this.setState({dialogOpen:!1})}async handleValueChanged(e,t){const{asyncUpdateRight:a}=this.context.apis;try{this.context.setProgressStatus(!0);let n={...t};n._id=e._id,n.email=e.email||this.state.group_id,n.module=e.api_code.toLowerCase();for(let a in t){let i=`${a}_trang_thai`;n[i]=w.a.cloneDeep(e[i]||{}),e.cac_trang_thai_phan_quyen.forEach(e=>{n[i][e.ma_trang_thai]=t[a]})}let i=await a(this.context.userInfo.token,n);for(let t in n)e[t]=n[t];e._id=i._id,this.state.menu.filter(t=>t.api_code===e.api_code).forEach(e=>{for(let t in n)e[t]=n[t];e._id=i._id}),this.setState({menu:this.state.menu}),this.context.setProgressStatus(!1)}catch(e){this.context.alert(e.message)}}async handleTrangThaiChanged(e,t){let a=this.state.currentItem;const{asyncUpdateRight:n}=this.context.apis;this.context.setProgressStatus(!0);try{e.check=t;let i={},r=`${this.state.currentRight}_trang_thai`;i[r]=w.a.cloneDeep(a[r]||{}),i[r][e.ma_trang_thai]=t,i._id=a._id,i.email=a.email||this.state.group,i.module=a.api_code.toLowerCase();let l=await n(this.context.userInfo.token,i);a[r]=i[r],a._id=l._id,this.state.menu.filter(e=>e.api_code===a.api_code).forEach(e=>{for(let t in i)e[t]=i[t];e._id=l._id}),this.setState({menu:this.state.menu}),this.context.setProgressStatus(!1)}catch(a){e.check=!t,this.context.alert(a.message)}}dialog(){let{groups:e,selectedGroup:t,currentItem:a}=this.state;const{getLabel:n}=this.context.apis,{formHeaderColor:r,mainTextColor:l}=this.context.config;return i.a.createElement(g.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"lg",open:this.state.dialogOpen,onClose:()=>this.cancel()},i.a.createElement(p.a,{style:{backgroundColor:r,color:l}},i.a.createElement(d.a,{container:!0,direction:"row",justify:"space-between"},i.a.createElement(d.a,{item:!0},n("Phân quyền")," : ",this.state.group_name),i.a.createElement(d.a,{item:!0},i.a.createElement(s.a,{onClick:()=>this.cancel(),style:{color:l}},i.a.createElement(f.a,{style:{color:"silver"}}))))),i.a.createElement(u.a,null,i.a.createElement(d.a,{container:!0},i.a.createElement(d.a,{item:!0,md:3},i.a.createElement(h.a,{elevation:1,style:{margin:10,padding:10}},e.map(e=>i.a.createElement(s.a,{style:{marginBottom:10},variant:"outlined",color:e===t?"secondary":"primary",fullWidth:!0,key:e.toString(),onClick:()=>{this.setState({selectedGroup:e})}},n(e))))),i.a.createElement(d.a,{item:!0,md:9},i.a.createElement(h.a,{elevation:0,style:{margin:10}},!!t&&i.a.createElement(i.a.Fragment,null,this.state.menu.filter(e=>e.group===t||e.name_mother_module===t).map((e,t)=>i.a.createElement(h.a,{key:t.toString(),style:{padding:10,marginBottom:10}},i.a.createElement(c.a,{variant:"title",component:"h5"},n(e.title)),i.a.createElement(d.a,{container:!0,spacing:1},i.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("view")>=0)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.view,color:"secondary",checked:e.view,onChange:t=>this.handleValueChanged(e,{view:t.target.checked})}),label:n("Xem")}),e.cac_trang_thai_phan_quyen.length>0&&e.view&&i.a.createElement("div",null,i.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"view")},n("Trạng thái"))))),i.a.createElement(d.a,{item:!0,xs:12,sm:12,md:3,lg:3},(!e.rights||e.rights.indexOf("viewOfOther")>=0)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.viewOfOther,color:"secondary",checked:e.viewOfOther,onChange:t=>this.handleValueChanged(e,{viewOfOther:t.target.checked})}),label:n("Xem của người khác")}))),i.a.createElement(d.a,{item:!0,xs:12,sm:12,md:3,lg:3},(!e.rights||e.rights.indexOf("add")>=0)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.add,color:"secondary",checked:e.add,onChange:t=>this.handleValueChanged(e,{add:t.target.checked})}),label:n("Thêm mới")}),e.cac_trang_thai_phan_quyen.length>0&&e.add&&i.a.createElement("div",null,i.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"add")},n("Trạng thái"))))),i.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("update")>=0)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.update,color:"secondary",checked:e.update,onChange:t=>this.handleValueChanged(e,{update:t.target.checked})}),label:n("Cập nhật")}),e.cac_trang_thai_phan_quyen.length>0&&e.update&&i.a.createElement("div",null,i.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"update")},n("Trạng thái"))))),i.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("delete")>=0)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.delete,color:"secondary",checked:e.delete,onChange:t=>this.handleValueChanged(e,{delete:t.target.checked})}),label:n("Xoá")}),e.cac_trang_thai_phan_quyen.length>0&&e.delete&&i.a.createElement("div",null,i.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"delete")},n("Trạng thái")))))))))))),i.a.createElement(g.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"sm",open:this.state.dialogTrangThaiOpen,onClose:()=>this.setState({dialogTrangThaiOpen:!1})},i.a.createElement(p.a,{style:{backgroundColor:r,color:l}},i.a.createElement(d.a,{container:!0,direction:"row",justify:"space-between"},i.a.createElement(d.a,{item:!0},n("Trạng thái có quyền")),i.a.createElement(d.a,{item:!0},i.a.createElement(s.a,{onClick:()=>this.setState({dialogTrangThaiOpen:!1}),style:{color:l}},"x")))),i.a.createElement(u.a,null,!!a&&a[`cac_trang_thai_phan_quyen_${this.state.currentRight}`].map(e=>i.a.createElement("div",{key:e.ma_trang_thai},i.a.createElement(m.a,{control:i.a.createElement(o.a,{value:e.check,color:"secondary",checked:e.check,onChange:t=>this.handleTrangThaiChanged(e,t.target.checked)}),label:n(e.ten_trang_thai)})))))))}render(){return this.dialog()}}x.contextType=_.a,x.propTypes={mediaQueryMatches:l.a.bool},t.default=Object(E.a)("(max-width:480px)")(x)}}]);