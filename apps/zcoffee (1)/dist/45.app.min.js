(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1726:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(55),l=a.n(i),c=a(1709),s=a(1703),o=a(1666),h=a(1707),m=a(882),d=a(480),g=a(1714),u=a(1715),p=a(437),_=a(374),E=a(403),y=a(397),f=a.n(y),w=a(418),v=a.n(w);class x extends r.a.Component{constructor(e){super(e),this.state={dialogOpen:!1,menu:[],groups:[],selectedGroup:null,dialogTrangThaiOpen:!1},this.showForm=this.showForm.bind(this),this.showTrangThai=this.showTrangThai.bind(this)}async componentDidMount(){}async loadright(e){const{asyncGetList:t,asyncGetMenu:a}=this.context.apis;this.context.setProgressStatus(!0);try{this.cac_trang_thai=await t(this.context.userInfo.token,"trangthai",{limit:3e4});const n=(await a(this.context.userInfo.token,e)).filter(e=>!e.system&&"home"!==e.code);n.forEach(e=>{e.cac_trang_thai_phan_quyen=[...this.cac_trang_thai.filter(t=>t.ma_ct.toUpperCase()===e.api_code.toUpperCase())]});const r=[...new Set(n.filter(e=>!e.mother_module).map(e=>e.group))],i=r.length>0?r[0]:null;this.setState({menu:n,groups:r,selectedGroup:i}),this.context.setProgressStatus(!1)}catch(e){console.error(this.context.userInfo),this.context.alert(e.message)}}async showForm(e,t=""){this.setState({dialogOpen:!0,group_id:e,group_name:t,menu:[],groups:[],selectedGroup:null},()=>{this.loadright(e)})}showTrangThai(e,t){const a=[...this.cac_trang_thai.filter(t=>t.ma_ct.toUpperCase()===e.api_code.toUpperCase())];a.forEach(a=>{console.log(e[t+"_trang_thai"],a.ma_trang_thai),a.check=(e[t+"_trang_thai"]||{})[a.ma_trang_thai],null==a.check&&(a.check=!0)}),e["cac_trang_thai_phan_quyen_"+t]=a,this.setState({currentItem:e,currentRight:t,dialogTrangThaiOpen:!0})}handleClose(){this.setState({dialogOpen:!1})}cancel(){this.setState({dialogOpen:!1})}async handleValueChanged(e,t){const{asyncUpdateRight:a}=this.context.apis;try{this.context.setProgressStatus(!0);let n={...t};n._id=e._id,n.email=e.email||this.state.group_id,n.module=e.api_code.toLowerCase();for(let a in t){let r=a+"_trang_thai";n[r]=v()(e[r]||{}),e.cac_trang_thai_phan_quyen.forEach(e=>{n[r][e.ma_trang_thai]=t[a]})}let r=await a(this.context.userInfo.token,n);for(let t in n)e[t]=n[t];e._id=r._id,this.state.menu.filter(t=>t.api_code===e.api_code).forEach(e=>{for(let t in n)e[t]=n[t];e._id=r._id}),this.setState({menu:this.state.menu}),this.context.setProgressStatus(!1)}catch(e){this.context.alert(e.message)}}async handleTrangThaiChanged(e,t){let a=this.state.currentItem;const{asyncUpdateRight:n}=this.context.apis;this.context.setProgressStatus(!0);try{e.check=t;let r={},i=this.state.currentRight+"_trang_thai";r[i]=v()(a[i]||{}),r[i][e.ma_trang_thai]=t,r._id=a._id,r.email=a.email||this.state.group,r.module=a.api_code.toLowerCase();let l=await n(this.context.userInfo.token,r);a[i]=r[i],a._id=l._id,this.state.menu.filter(e=>e.api_code===a.api_code).forEach(e=>{for(let t in r)e[t]=r[t];e._id=l._id}),this.setState({menu:this.state.menu}),this.context.setProgressStatus(!1)}catch(a){e.check=!t,this.context.alert(a.message)}}dialog(){let{groups:e,selectedGroup:t,currentItem:a}=this.state;const{getLabel:n}=this.context.apis,{formHeaderColor:i,mainTextColor:l}=this.context.config;return r.a.createElement(g.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"lg",open:this.state.dialogOpen,onClose:()=>this.cancel()},r.a.createElement(p.a,{style:{backgroundColor:i,color:l}},r.a.createElement(d.a,{container:!0,direction:"row",justify:"space-between"},r.a.createElement(d.a,{item:!0},n("Phân quyền")," : ",this.state.group_name),r.a.createElement(d.a,{item:!0},r.a.createElement(s.a,{onClick:()=>this.cancel(),style:{color:l}},r.a.createElement(f.a,{style:{color:"silver"}}))))),r.a.createElement(u.a,{style:{backgroundColor:this.context.config.secondaryColor}},r.a.createElement(d.a,{container:!0},r.a.createElement(d.a,{item:!0,md:3},r.a.createElement(h.a,{elevation:1,style:{margin:10,padding:10}},e.map(e=>r.a.createElement(s.a,{style:{marginBottom:10},variant:"outlined",color:e===t?"secondary":"primary",fullWidth:!0,key:e.toString(),onClick:()=>{this.setState({selectedGroup:e})}},n(e))))),r.a.createElement(d.a,{item:!0,md:9},r.a.createElement("div",{elevation:0,style:{margin:10}},!!t&&r.a.createElement(r.a.Fragment,null,this.state.menu.filter(e=>e.group===t||e.name_mother_module===t).sort((e,t)=>e.stt-t.stt).map((e,t)=>r.a.createElement(h.a,{key:t.toString(),style:{padding:10,marginBottom:10}},r.a.createElement(c.a,{variant:"title",component:"h5"},n(e.title)),r.a.createElement(d.a,{container:!0,spacing:1},r.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("view")>=0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.view,color:"primary",checked:e.view,onChange:t=>this.handleValueChanged(e,{view:t.target.checked})}),label:n("Xem")}),e.cac_trang_thai_phan_quyen.length>0&&e.view&&r.a.createElement("div",null,r.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"view")},n("Trạng thái"))))),r.a.createElement(d.a,{item:!0,xs:12,sm:12,md:3,lg:3},(!e.rights||e.rights.indexOf("viewOfOther")>=0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.viewOfOther,color:"primary",checked:e.viewOfOther,onChange:t=>this.handleValueChanged(e,{viewOfOther:t.target.checked})}),label:n("Xem của người khác")}))),r.a.createElement(d.a,{item:!0,xs:12,sm:12,md:3,lg:3},(!e.rights||e.rights.indexOf("add")>=0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.add,color:"primary",checked:e.add,onChange:t=>this.handleValueChanged(e,{add:t.target.checked})}),label:n("Thêm mới")}),e.cac_trang_thai_phan_quyen.length>0&&e.add&&r.a.createElement("div",null,r.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"add")},n("Trạng thái"))))),r.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("update")>=0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.update,color:"primary",checked:e.update,onChange:t=>this.handleValueChanged(e,{update:t.target.checked})}),label:n("Cập nhật")}),e.cac_trang_thai_phan_quyen.length>0&&e.update&&r.a.createElement("div",null,r.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"update")},n("Trạng thái"))))),r.a.createElement(d.a,{item:!0,xs:12,sm:12,md:2,lg:2},(!e.rights||e.rights.indexOf("delete")>=0)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.delete,color:"primary",checked:e.delete,onChange:t=>this.handleValueChanged(e,{delete:t.target.checked})}),label:n("Xoá")}),e.cac_trang_thai_phan_quyen.length>0&&e.delete&&r.a.createElement("div",null,r.a.createElement(s.a,{size:"small",variant:"outlined",onClick:()=>this.showTrangThai(e,"delete")},n("Trạng thái")))))))))))),r.a.createElement(g.a,{fullScreen:this.props.mediaQueryMatches,fullWidth:!0,maxWidth:"sm",open:this.state.dialogTrangThaiOpen,onClose:()=>this.setState({dialogTrangThaiOpen:!1})},r.a.createElement(p.a,{style:{backgroundColor:i,color:l}},r.a.createElement(d.a,{container:!0,direction:"row",justify:"space-between"},r.a.createElement(d.a,{item:!0},n("Trạng thái có quyền")),r.a.createElement(d.a,{item:!0},r.a.createElement(s.a,{onClick:()=>this.setState({dialogTrangThaiOpen:!1}),style:{color:l}},"x")))),r.a.createElement(u.a,null,!!a&&a["cac_trang_thai_phan_quyen_"+this.state.currentRight].map(e=>r.a.createElement("div",{key:e.ma_trang_thai},r.a.createElement(m.a,{control:r.a.createElement(o.a,{value:e.check,color:"primary",checked:e.check,onChange:t=>this.handleTrangThaiChanged(e,t.target.checked)}),label:n(e.ten_trang_thai)})))))))}render(){return this.dialog()}}x.contextType=_.a,x.propTypes={mediaQueryMatches:l.a.bool},t.default=Object(E.a)("(max-width:480px)")(x)},403:function(e,t,a){"use strict";var n=a(1),r=a.n(n),i=a(55),l=a.n(i),c=a(504);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}t.a=(...e)=>t=>a=>{const n=Object(c.a)(...e),i=e=>{const{forwardedRef:a,...i}=e;return r.a.createElement(t,s({ref:a},i,{mediaQueryMatches:n}))};return i.propTypes={forwardedRef:l.a.any},r.a.createElement(i,a)}},437:function(e,t,a){"use strict";var n=a(12),r=a(368),i=a(1),l=(a(55),a(369)),c=a(370),s=a(1709),o=i.forwardRef((function(e,t){var a=e.children,c=e.classes,o=e.className,h=e.disableTypography,m=void 0!==h&&h,d=Object(r.a)(e,["children","classes","className","disableTypography"]);return i.createElement("div",Object(n.a)({className:Object(l.a)(c.root,o),ref:t},d),m?a:i.createElement(s.a,{component:"h2",variant:"h6"},a))}));t.a=Object(c.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(o)}}]);