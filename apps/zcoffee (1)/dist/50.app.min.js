(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{640:function(e,t,a){"use strict";var n=Array.isArray,s=Object.keys,o=Object.prototype.hasOwnProperty;e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){var i,r,l,c=n(t),h=n(a);if(c&&h){if((r=t.length)!=a.length)return!1;for(i=r;0!=i--;)if(!e(t[i],a[i]))return!1;return!0}if(c!=h)return!1;var d=t instanceof Date,p=a instanceof Date;if(d!=p)return!1;if(d&&p)return t.getTime()==a.getTime();var f=t instanceof RegExp,m=a instanceof RegExp;if(f!=m)return!1;if(f&&m)return t.toString()==a.toString();var u=s(t);if((r=u.length)!==s(a).length)return!1;for(i=r;0!=i--;)if(!o.call(a,u[i]))return!1;for(i=r;0!=i--;)if(!e(t[l=u[i]],a[l]))return!1;return!0}return t!=t&&a!=a}},641:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),o=a(1703),i=a(480),r=a(1714),l=a(1715),c=a(437),h=a(640),d=a.n(h),p=a(543),f=a.n(p),m=a(386),u=a.n(m),g=a(55),b=a.n(g),C=a(418),y=a.n(C),x=a(374),w=a(522);class E extends n.Component{constructor(e){super(e);let t=this.props.form;!t&&this.props.fields&&(t=this.createForm(this.props.fields)),this.state={open:this.props.open,searchCondition:{...this.props.defaultCondition},searchForm:t,FormBase:null,load:0}}async componentDidMount(){this.props.fields&&(this.validationConstraints=Object(w.a)(this.props.fields,this.context))}async open(){if(this.state.FormBase)this.setState({open:!0});else{const{default:e}=await Promise.all([a.e(3),a.e(2),a.e(5),a.e(7),a.e(17)]).then(a.bind(null,526));this.setState({FormBase:e,load:this.state.load+1,open:!0})}}close(){this.setState({open:!1})}shouldComponentUpdate(e,t){return!d()(t.load,this.state.load)||(!d()(t.open,this.state.open)||(!d()(e.defaultCondition,this.props.defaultCondition)||(!d()(e.searchLabel,this.props.searchLabel)||!d()(e.cancelLabel,this.props.cancelLabel)||(!d()(t.searchCondition,this.state.searchCondition)||!(!e.fields||this.props.fields)&&(console.log("fields changed, rerender search form"),!0)))))}componentDidUpdate(e){if(this.props.fields&&!this.props.form&&!d()(e.fields,this.props.fields)){const e=this.createForm(this.props.fields);this.setState({searchForm:e}),this.validationConstraints=Object(w.a)(this.props.fields,this.context)}d()(e.defaultCondition,this.props.defaultCondition)||this.setState({searchCondition:{...this.props.defaultCondition}})}createForm(e){return(t,a)=>{let n=this.fields=y()(e);return this.props.isReport||Array.from(n).forEach(e=>{if(delete e.tab,delete e.handle_value_changed,n.length<=3&&n.length>0?e.grid_configs_required={md:12/n.length,lg:12/n.length,readOnly:!1}:e.grid_configs_required={md:4,lg:4,readOnly:!1},"Date"===e.type){let t=Object.assign({},e);t.name=t.name+"_tu",t.header=t.header+" từ",t.setCondition=(t,a)=>{let n=u()(a).startOf("date").toDate();t[e.name]&&"object"==typeof t[e.name]?t[e.name].$gte=n:t[e.name]={$gte:n}},n.push(t);let a=Object.assign({},e);a.name=a.name+"_den",a.header=a.header+" đến",a.setCondition=(t,a)=>{let n=u()(a).startOf("date").toDate();t[e.name]&&"object"==typeof t[e.name]?t[e.name].$lte=n:t[e.name]={$lte:n}},n.push(a),n=n.filter(t=>t.name!==e.name)}"Number"!==e.type&&"Boolean"!==e.type||(e.setCondition=(t,a)=>{t[e.name]=a}),"Array"===e.type&&(e.setCondition=(t,a)=>{a&&a.length>0&&(t[e.name]={$in:a})})}),s.a.createElement(s.a.Fragment,null,this.state.FormBase&&s.a.createElement(this.state.FormBase,{style:{padding:0},fields:n,data:t,handleValueChanged:a}))}}search(){let e=this.state.searchCondition,t=this.validationConstraints||{},a=f()(e,t,{format:"flat"});if(a){let e=a.join("<br/>");this.context.alert(e)}else this.setState({open:!1},()=>{this.props.onSearch&&this.props.onSearch(e,this.state.query,this.fields)})}handleSearchConditionChanged(e,t){let a=y()(this.state.searchCondition);for(let t in e)a[t]=e[t];let n=this.state.query;if(t)if(n)for(let e in t)"$or"!=e&&"$and"!=e||!n[e]?n[e]=t[e]:n=[e].push(t[e]);else n={...t};this.setState({searchCondition:a,query:n})}render(){if(!this.state.open)return null;const{searchCondition:e,searchForm:t}=this.state;return s.a.createElement(r.a,{maxWidth:this.props.formSize||"md",open:!1!==this.props.allowClose&&this.state.open,onClose:()=>this.setState({open:!1}),disableBackdropClick:this.props.disableBackdropClick,disableEscapeKeyDown:this.props.disableEscapeKeyDown},s.a.createElement(c.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},s.a.createElement(i.a,{container:!0,direction:"row",justify:"space-between"},s.a.createElement(i.a,{item:!0},this.context.apis.getLabel("Điều kiện lọc")),s.a.createElement(i.a,{item:!0,style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",paddingLeft:10}},s.a.createElement(o.a,{type:"Button",variant:"contained",color:"secondary",onClick:this.search.bind(this)},this.context.apis.getLabel(this.props.searchLabel||"Tìm")),!1!==this.props.allowClose&&s.a.createElement(o.a,{variant:"contained",style:{marginLeft:5},onClick:()=>this.setState({open:!1})},this.context.apis.getLabel(this.props.cancelLabel||"Tắt"))))),s.a.createElement(l.a,{style:{padding:0}},s.a.createElement("form",{noValidate:!0,style:{display:"flex",flexDirection:"column"}},s.a.createElement("div",{style:{flexGrow:1}},!!t&&t(e,this.handleSearchConditionChanged.bind(this))))))}}E.contextType=x.a,E.propTypes={fields:b.a.arrayOf(b.a.object),onSearch:b.a.func,form:b.a.func,defaultCondition:b.a.object,open:b.a.bool,isReport:b.a.bool,disableBackdropClick:b.a.bool,disableEscapeKeyDown:b.a.bool,searchLabel:b.a.string,cancelLabel:b.a.string,allowClose:b.a.bool,formSize:b.a.oneOf(["sm","md","lg"])},t.default=E}},0,[3,2,5,7,17]]);