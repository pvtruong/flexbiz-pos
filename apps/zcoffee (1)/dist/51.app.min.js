(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{811:function(t,e,o){"use strict";o.r(e);var s=o(1),n=o.n(s),a=o(1703),i=o(480),r=o(1714),l=o(1715),p=o(437),c=o(543),h=o.n(c),d=o(55),f=o.n(d),m=o(397),u=o.n(m),x=o(418),C=o.n(x),y=o(544),g=o(374),w=o(522);class b extends s.Component{constructor(t){super(t),this.state={open:this.props.open,options:this.props.defaultOptions||{},optionsForm:null,FormBase:null}}async open(t){if(t&&(this.onSave=t),this.state.FormBase)this.setState({open:!0});else{const{default:t}=await Promise.all([o.e(3),o.e(2),o.e(5),o.e(7),o.e(17)]).then(o.bind(null,526));this.setState({open:!0,FormBase:t})}}close(){this.setState({open:!1})}async componentDidMount(){let t=[];if(this.props.defaultOptionsCode){let e=await this.context.apis.asyncGetData(this.context.userInfo.token,"listinfo",{code:this.props.defaultOptionsCode.toLowerCase()},"fields");e&&(t=t.concat(e))}let e=await this.context.apis.asyncGetData(this.context.userInfo.token,"listinfo",{code:this.props.optionsFormCode.toLowerCase()},"fields");e&&(t=[...t,...e]),t.forEach(t=>{t.tab||(t.tab=this.context.apis.getLabel("Tuỳ chọn chung"))});const o=this.createForm(t);let s=await this.context.apis.asyncGetData(this.context.userInfo.token,"options",{id_func:this.props.optionsDataCode.toLowerCase()});s||(s={id_func:this.props.optionsDataCode.toLowerCase(),option:{}}),s.option||(s.option={},await Object(y.a)(s.option,t,this.context,{},this.context.userInfo.token)),s.option.ma_ct=this.props.optionsDataCode.toUpperCase(),this.setState({optionsForm:o,options:s}),this.validationConstraints=Object(w.a)(this.props.fields,this.context)}createForm(t){return(e,o)=>{let s=this.fields=C()(t);return n.a.createElement(n.a.Fragment,null,this.state.FormBase&&n.a.createElement(this.state.FormBase,{style:{padding:0},fields:s,data:e,handleValueChanged:o}))}}async save(){let t=this.state.options.option,e=this.validationConstraints||{},o=h()(t,e,{format:"flat"});if(o){let t=o.join("<br/>");this.context.alert(t)}else try{console.log("save options",this.state.options);let t=await this.context.apis.asyncPostList(this.context.userInfo.token,"options",this.state.options);this.close(),this.onSave&&this.onSave(t.option)}catch(t){this.context.alert(t.message)}}handleOptionsChanged(t){let e=C()(this.state.options.option);for(let o in t)e[o]=t[o];this.state.options.option=e,this.setState({options:this.state.options})}render(){const{options:t,optionsForm:e,FormBase:o}=this.state;return this.state.open&&t&&o?n.a.createElement(r.a,{maxWidth:this.props.formSize||"md",fullWidth:!0,open:this.state.open,onClose:()=>this.setState({open:!1})},n.a.createElement(p.a,{style:{backgroundColor:this.context.config.formHeaderColor,color:this.context.config.mainTextColor}},n.a.createElement(i.a,{container:!0,direction:"row",justify:"space-between"},n.a.createElement(i.a,{item:!0},this.context.apis.getLabel("Tuỳ chọn")),n.a.createElement(i.a,{item:!0,style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",paddingLeft:10}},n.a.createElement(a.a,{type:"Button",variant:"contained",color:"secondary",onClick:this.save.bind(this)},this.context.apis.getLabel("Lưu")),n.a.createElement(a.a,{variant:"contained",style:{marginLeft:5},onClick:()=>this.setState({open:!1})},n.a.createElement(u.a,null))))),n.a.createElement(l.a,{style:{padding:0,minWidth:240}},n.a.createElement("form",{noValidate:!0,style:{display:"flex",flexDirection:"column"}},n.a.createElement("div",{style:{flexGrow:1}},!!e&&e(t.option,this.handleOptionsChanged.bind(this)))))):null}}b.contextType=g.a,b.propTypes={optionsDataCode:f.a.string.isRequired,optionsFormCode:f.a.string.isRequired,fields:f.a.array,defaultOptionsCode:f.a.string,defaultOptions:f.a.object,formSize:f.a.oneOf(["sm","md","lg"]),open:f.a.bool},e.default=b}},0,[3,2,5,7,17]]);